<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Your Cart ‚Äî MotoParts</title>
  <link rel="stylesheet" href="style.css">
  <style>
    /* small, local styles to ensure cart layout even if global CSS differs */
    main { max-width:1100px; margin:20px auto; padding:0 20px;}
    .cart-item { display:flex; gap:12px; align-items:center; background:#fff; padding:12px; border-radius:8px; margin-bottom:10px; box-shadow:0 2px 6px rgba(0,0,0,0.05); }
    .cart-item img { width:120px; height:80px; object-fit:cover; border-radius:6px; }
    .cart-item .info { flex:1; }
    .cart-actions { display:flex; gap:8px; align-items:center; }
    .qty-btn { padding:6px 8px; border-radius:6px; border:1px solid #ddd; background:#f7f7f7; cursor:pointer; }
    .remove-btn { background:#ef4444; color:#fff; border:none; padding:8px 10px; border-radius:6px; cursor:pointer; }
    .cart-footer { display:flex; justify-content:space-between; align-items:center; margin-top:16px; }
    .checkout-btn { background:#10b981; color:#fff; border:none; padding:10px 16px; border-radius:8px; cursor:pointer; font-weight:700; }
    .empty { text-align:center; padding:36px; color:#666; }
  </style>
</head>
<body>
  <header style="background:#111;color:#fff;padding:14px 20px;">
    <div style="max-width:1100px;margin:0 auto;display:flex;justify-content:space-between;align-items:center">
      <div>
        <a href="index.html" style="color:#fff;text-decoration:none;font-weight:700">üèçÔ∏è MotoParts</a>
      </div>
      <nav>
        <a href="index.html" style="color:#fff;margin-right:12px;text-decoration:none">Home</a>
        <a href="checkout.html" style="color:#fff;text-decoration:none">Checkout</a>
      </nav>
    </div>
  </header>

  <main>
    <h1 style="margin:18px 0">Your Cart</h1>

    <section id="cart-list"></section>

    <div class="cart-footer" id="cart-footer" style="max-width:1100px;margin:0 auto;padding:0 20px;">
      <div id="summary">Subtotal: KES <strong id="cart-total">0.00</strong></div>
      <div style="display:flex;gap:10px;">
        <button id="clearCartBtn" class="qty-btn">Clear Cart</button>
        <button id="checkoutBtn" class="checkout-btn">Proceed to Checkout</button>
      </div>
    </div>
  </main>

  <script>
    // Keys must match the rest of the app
    const CART_KEY = 'moto_cart';
    const PRODUCTS_KEY = 'moto_products';

    // Helpers
    function getCart() {
      try { return JSON.parse(localStorage.getItem(CART_KEY) || '[]'); } catch(e){ return []; }
    }
    function saveCart(cart) {
      localStorage.setItem(CART_KEY, JSON.stringify(cart));
      updateHeaderCount(); // update header badge if present
    }
    function getProducts() {
      try { return JSON.parse(localStorage.getItem(PRODUCTS_KEY) || '[]'); } catch(e){ return []; }
    }

    // DOM nodes
    const cartList = document.getElementById('cart-list');
    const cartTotalEl = document.getElementById('cart-total');
    const clearCartBtn = document.getElementById('clearCartBtn');
    const checkoutBtn = document.getElementById('checkoutBtn');

    // Render cart items
    function renderCart() {
      const cart = getCart();
      if (!cart.length) {
        cartList.innerHTML = '<div class="empty">Your cart is empty. <a href="index.html">Shop parts</a></div>';
        cartTotalEl.textContent = '0.00';
        return;
      }

      // Get product metadata (images, stock) from products storage for better display
      const products = getProducts();

      cartList.innerHTML = '';
      let subtotal = 0;

      cart.forEach((item, index) => {
        const productMeta = products.find(p => Number(p.id) === Number(item.id)) || {};
        const img = productMeta.image || 'https://via.placeholder.com/400x300?text=No+image';
        const title = item.name || productMeta.name || 'Product';
        const price = Number(item.price || productMeta.price || 0);
        const qty = Number(item.qty || 1);
        subtotal += price * qty;

        const el = document.createElement('div');
        el.className = 'cart-item';
        el.innerHTML = `
          <img src="${img}" alt="${title}">
          <div class="info">
            <div style="display:flex;justify-content:space-between;align-items:flex-start;">
              <div>
                <div style="font-weight:700">${title}</div>
                <div style="color:#666;font-size:13px">KES ${Number(price).toLocaleString()}</div>
              </div>
              <div class="cart-actions">
                <button class="qty-btn" data-index="${index}" data-action="decrease">-</button>
                <div style="padding:6px 10px;border-radius:6px;border:1px solid #eee">${qty}</div>
                <button class="qty-btn" data-index="${index}" data-action="increase">+</button>
                <button class="remove-btn" data-index="${index}">Remove</button>
              </div>
            </div>
          </div>
        `;
        cartList.appendChild(el);
      });

      cartTotalEl.textContent = subtotal.toFixed(2);
    }

    // Update header cart count (if header has an element with id "cartCount")
    function updateHeaderCount() {
      const el = document.getElementById('cartCount');
      if (!el) return;
      const totalQty = getCart().reduce((s, i) => s + (i.qty || 0), 0);
      el.textContent = totalQty;
    }

    // Increase / decrease / remove handlers (event delegation)
    cartList.addEventListener('click', (e) => {
      const idx = e.target.getAttribute('data-index');
      const action = e.target.getAttribute('data-action');

      if (idx === null) return;
      const index = Number(idx);
      const cart = getCart();
      if (!cart[index]) return;

      if (action === 'decrease') {
        cart[index].qty = Math.max(1, (cart[index].qty || 1) - 1);
        saveCart(cart);
        renderCart();
      } else if (action === 'increase') {
        cart[index].qty = (cart[index].qty || 1) + 1;
        saveCart(cart);
        renderCart();
      } else if (e.target.classList.contains('remove-btn')) {
        cart.splice(index, 1);
        saveCart(cart);
        renderCart();
      }
    });

    // Clear cart
    function clearCart() {
      if (!confirm('Clear all items from cart?')) return;
      saveCart([]);
      renderCart();
    }
    clearCartBtn.addEventListener('click', clearCart);

    // Checkout button - here it navigates to checkout page (which will collect info)
    checkoutBtn.addEventListener('click', () => {
      const cart = getCart();
      if (!cart.length) { alert('Your cart is empty'); return; }
      // you can also save any temp order here or navigate to a checkout page
      location.href = 'checkout.html';
    });

    // init
    document.addEventListener('DOMContentLoaded', () => {
      renderCart();
      updateHeaderCount();
    });
  </script>
</body>
</html>
